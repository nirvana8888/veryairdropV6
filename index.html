<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Very Multisender</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f0f0f0;
        }
        h1 {
            color: #333;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        textarea {
            width: 90%;
            max-width: 500px;
            height: 150px;
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        input[type="number"] {
            width: 150px;
            padding: 8px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        #status {
            color: #28a745;
            margin-top: 10px;
        }
        #error {
            color: #dc3545;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Very Multisender</h1>
    <p>Send equal amounts of $VERY to multiple addresses on Very Network</p>

    <button onclick="connectWallet()">Connect MetaMask</button>
    <p>Wallet: <span id="walletAddress">Not connected</span></p>

    <h3>Recipients</h3>
    <p>Enter one address per line</p>
    <textarea id="recipients" placeholder="0xAddress1&#10;0xAddress2&#10;0xAddress3"></textarea>

    <h3>Amount per Address ($VERY)</h3>
    <input type="number" id="amount" step="0.001" min="0" placeholder="e.g., 1.5">

    <br>
    <button onclick="sendEqualVery()">Send $VERY</button>

    <p id="status"></p>
    <p id="error"></p>

    <!-- Load ethers.js -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script>
        // Contract details
        const contractAddress = "0x39abbd8be6205a4a5a7671a7424c743851c9a2e9";
        const contractABI = [
            {
                "inputs": [
                    {"internalType": "address payable[]", "name": "recipients", "type": "address[]"},
                    {"internalType": "uint256[]", "name": "amounts", "type": "uint256[]"}
                ],
                "name": "multiSend",
                "outputs": [{"internalType": "bool", "name": "", "type": "bool"}],
                "stateMutability": "payable",
                "type": "function"
            }
        ];

        let provider, signer, contract;

        async function connectWallet() {
            const status = document.getElementById('status');
            const error = document.getElementById('error');
            const walletAddress = document.getElementById('walletAddress');

            if (!window.ethereum) {
                error.textContent = "MetaMask is not installed!";
                return;
            }

            try {
                // Very Network config (Chain ID 4613)
                const veryChainId = '0x120d'; // 4613 in hex
                const veryNetwork = {
                    chainId: veryChainId,
                    chainName: "Very Network",
                    rpcUrls: ["https://rpc.verylabs.io"],
                    nativeCurrency: { name: "VERY", symbol: "VERY", decimals: 18 },
                    blockExplorerUrls: ["https://www.veryscan.io"]
                };

                // Request accounts and check Chain ID
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                const currentChainId = await window.ethereum.request({ method: 'eth_chainId' });
                console.log(`Current Chain ID: ${currentChainId} (Decimal: ${parseInt(currentChainId, 16)})`);

                // Switch to Chain ID 4613 if needed
                if (currentChainId !== veryChainId) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: veryChainId }]
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [veryNetwork]
                            });
                        } else {
                            throw switchError;
                        }
                    }
                    const newChainId = await window.ethereum.request({ method: 'eth_chainId' });
                    console.log(`Switched Chain ID: ${newChainId} (Decimal: ${parseInt(newChainId, 16)})`);
                    if (newChainId !== veryChainId) {
                        throw new Error(`Failed to switch to Chain ID 4613, got ${newChainId}`);
                    }
                }

                // Set up provider and contract
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                contract = new ethers.Contract(contractAddress, contractABI, signer);

                const address = await signer.getAddress();
                walletAddress.textContent = address;
                status.textContent = "Connected to Very Network!";
                error.textContent = "";
            } catch (err) {
                error.textContent = `Error: ${err.message}`;
                status.textContent = "";
            }
        }

        async function sendEqualVery() {
            const status = document.getElementById('status');
            const error = document.getElementById('error');
            const recipientsInput = document.getElementById('recipients').value.trim();
            const amountInput = document.getElementById('amount').value.trim();

            if (!contract) {
                error.textContent = "Please connect your wallet first!";
                return;
            }
            if (!recipientsInput || !amountInput) {
                error.textContent = "Enter recipients and an amount!";
                return;
            }

            try {
                const recipientList = recipientsInput.split('\n').map(line => line.trim()).filter(line => line);
                const amount = parseFloat(amountInput);

                if (recipientList.length === 0) throw new Error("No recipients provided");
                if (isNaN(amount) || amount <= 0) throw new Error("Amount must be a positive number");

                // Validate addresses
                const recipients = recipientList.map(address => {
                    if (!ethers.utils.isAddress(address)) throw new Error(`Invalid address: ${address}`);
                    return address;
                });

                // Create equal amounts array
                const amounts = recipients.map(() => ethers.utils.parseEther(amount.toString()));
                const totalVery = ethers.utils.parseEther((amount * recipients.length).toString());

                status.textContent = "Sending $VERY...";
                error.textContent = "";

                const tx = await contract.multiSend(recipients, amounts, { value: totalVery });
                await tx.wait();

                status.textContent = "Success! Check veryscan.io for details.";
                error.textContent = "";
            } catch (err) {
                error.textContent = `Error: ${err.message}`;
                status.textContent = "";
            }
        }
    </script>
</body>
</html>
